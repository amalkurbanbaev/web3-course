import{q as O,G,I as K,u as M,v as k,r as p,J,K as X,t as Z,j as e,o as C,c as b,w as D,M as ee,P as te,Q as ae,C as N,R as ne,U as se,V as re,X as oe}from"./index-BwZLMKpZ.js";import{u as ie,a as ce,D as le,A as de,b as ue,L as fe}from"./use-symbol-erc-20-abnbSPpC.js";import{g as _,f as pe,u as P}from"./useTokenManagement-DOWQ6FY1.js";import{f as me,u as xe,p as he,a as ge,t as q,C as ve,b as ye}from"./wagmi.gen-B6TVVBtD.js";import{c as je,B as L}from"./button-CBoGhXrv.js";import{D as Ne}from"./tokens-4usJcAD4.js";/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],I=O("arrow-right",be);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Ae=O("external-link",we);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["line",{x1:"3",x2:"15",y1:"22",y2:"22",key:"xegly4"}],["line",{x1:"4",x2:"14",y1:"9",y2:"9",key:"xcnuvu"}],["path",{d:"M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18",key:"16j0yd"}],["path",{d:"M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5",key:"7cu91f"}]],ke=O("fuel",Ce);/**
 * @license lucide-react v0.503.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M12 7v2",key:"stiyo7"}],["path",{d:"M12 13h.01",key:"y0uutt"}]],Se=O("message-square-warning",Te);function Oe(t,a={}){return{async queryFn({queryKey:r}){var c;const s=[],n=r[1].contracts.length;for(let d=0;d<n;d++){const l=r[1].contracts[d],f=((c=a.contracts)==null?void 0:c[d]).abi;s.push({...l,abi:f})}const{scopeKey:o,...i}=r[1];return G(t,{...i,contracts:s})},queryKey:Ie(a)}}function Ie(t={}){const a=[];for(const r of t.contracts??[]){const{abi:s,...n}=r;a.push({...n,chainId:n.chainId??t.chainId})}return["readContracts",K({...t,contracts:a})]}function Ee(t={}){const{contracts:a=[],query:r={}}=t,s=M(t),n=k({config:s}),o=Oe(s,{...t,chainId:n}),i=p.useMemo(()=>{let c=!1;for(const d of a){const{abi:l,address:f,functionName:m}=d;if(!l||!f||!m){c=!1;break}c=!0}return!!(c&&(r.enabled??!0))},[a,r.enabled]);return J({...o,...r,enabled:i,structuralSharing:r.structuralSharing??X})}function S({address:t,amount:a=BigInt(0)}){const r=k(),{allTokens:s}=_(r),n=t?s.get(t):void 0,{data:o}=ie(t,!!(n!=null&&n.decimals)),{data:i}=ce(t,!!(n!=null&&n.symbol)),c=(n==null?void 0:n.decimals)??o,d=(n==null?void 0:n.symbol)??i,l=(n==null?void 0:n.image)??le,f=Number(Z(a,c||0)).toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:6});return e.jsxs("div",{className:"flex items-center gap-2",children:[l&&e.jsx("img",{src:l,alt:d,className:"size-12"}),e.jsxs("div",{className:"flex flex-col justify-center",children:[e.jsx("span",{className:"text-xl",children:f}),e.jsx("span",{className:"text-muted-foreground text-sm",children:d})]})]})}function V({address1:t,address2:a,amount1:r,amount2:s}){const n=k(),{allTokens:o}=_(n),i=t?o.get(t):void 0,c=a?o.get(a):void 0,d=!!t&&!!a&&!!r&&!!s,{data:l}=Ee({contracts:[{abi:C,address:t,functionName:"decimals"},{abi:C,address:a,functionName:"decimals"}],query:{enabled:d,staleTime:Number.POSITIVE_INFINITY}}),f=(i==null?void 0:i.decimals)??(l==null?void 0:l[0].result),m=(c==null?void 0:c.decimals)??(l==null?void 0:l[1].result),u=me(r,s,f,m);return e.jsxs("div",{className:"ml-auto flex flex-col rounded-md border p-2",children:[e.jsx("div",{className:"text-lg",children:u}),e.jsx("div",{className:"text-muted-foreground text-xs",children:"Rate"})]})}function z({className:t,...a}){return e.jsx("div",{"data-slot":"card",className:b("flex flex-col gap-6 rounded-xl border bg-card py-6 text-card-foreground shadow-sm",t),...a})}function U({className:t,...a}){return e.jsx("div",{"data-slot":"card-header",className:b("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...a})}function H({className:t,...a}){return e.jsx("div",{"data-slot":"card-title",className:b("font-semibold leading-none",t),...a})}function E({className:t,...a}){return e.jsx("div",{"data-slot":"card-description",className:b("text-muted-foreground text-sm",t),...a})}function W({className:t,...a}){return e.jsx("div",{"data-slot":"card-content",className:b("px-6",t),...a})}function Re({className:t,...a}){return e.jsx("div",{"data-slot":"card-footer",className:b("flex items-center px-6 [.border-t]:pt-6",t),...a})}function De(t){const a=_e(t),r=p.forwardRef((s,n)=>{const{children:o,...i}=s,c=p.Children.toArray(o),d=c.find(Le);if(d){const l=d.props.children,f=c.map(m=>m===d?p.Children.count(l)>1?p.Children.only(null):p.isValidElement(l)?l.props.children:null:m);return e.jsx(a,{...i,ref:n,children:p.isValidElement(l)?p.cloneElement(l,void 0,f):null})}return e.jsx(a,{...i,ref:n,children:o})});return r.displayName=`${t}.Slot`,r}function _e(t){const a=p.forwardRef((r,s)=>{const{children:n,...o}=r;if(p.isValidElement(n)){const i=Be(n),c=Fe(o,n.props);return n.type!==p.Fragment&&(c.ref=s?je(s,i):i),p.cloneElement(n,c)}return p.Children.count(n)>1?p.Children.only(null):null});return a.displayName=`${t}.SlotClone`,a}var Pe=Symbol("radix.slottable");function Le(t){return p.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Pe}function Fe(t,a){const r={...a};for(const s in a){const n=t[s],o=a[s];/^on[A-Z]/.test(s)?n&&o?r[s]=(...c)=>{const d=o(...c);return n(...c),d}:n&&(r[s]=n):s==="style"?r[s]={...n,...o}:s==="className"&&(r[s]=[n,o].filter(Boolean).join(" "))}return{...t,...r}}function Be(t){var s,n;let a=(s=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:s.get,r=a&&"isReactWarning"in a&&a.isReactWarning;return r?t.ref:(a=(n=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:n.get,r=a&&"isReactWarning"in a&&a.isReactWarning,r?t.props.ref:t.props.ref||t.ref)}var qe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ve=qe.reduce((t,a)=>{const r=De(`Primitive.${a}`),s=p.forwardRef((n,o)=>{const{asChild:i,...c}=n,d=i?r:a;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),e.jsx(d,{...c,ref:o})});return s.displayName=`Primitive.${a}`,{...t,[a]:s}},{}),ze="Separator",F="horizontal",Ue=["horizontal","vertical"],$=p.forwardRef((t,a)=>{const{decorative:r,orientation:s=F,...n}=t,o=He(s)?s:F,c=r?{role:"none"}:{"aria-orientation":o==="vertical"?o:void 0,role:"separator"};return e.jsx(Ve.div,{"data-orientation":o,...c,...n,ref:a})});$.displayName=ze;function He(t){return Ue.includes(t)}var We=$;function R({className:t,orientation:a="horizontal",decorative:r=!0,...s}){return e.jsx(We,{"data-slot":"separator-root",decorative:r,orientation:a,className:b("shrink-0 bg-border data-[orientation=horizontal]:h-px data-[orientation=vertical]:h-full data-[orientation=horizontal]:w-full data-[orientation=vertical]:w-px",t),...s})}const $e=Ne;function Ye(t){var y;const a=k(),{address:r,chain:s}=D(),{allTokens:n}=_(a),{data:o,isLoading:i}=xe({args:[BigInt(t)]}),c=he(o),{tokenFrom:d,tokenTo:l,amountFrom:f,amountTo:m,optionalTaker:u,completed:h,creator:j}=c,w=j===r,v=u===r||u===$e,x=l?(y=n.get(l))==null?void 0:y.symbol:void 0,g=(s==null?void 0:s.nativeCurrency.symbol)===x;return{detailsLoading:i,tokenFrom:d,tokenTo:l,amountFrom:f,amountTo:m,optionalTaker:u,completed:h,creator:j,isUserOfferOwner:w,isNativeTokenTo:g,isUserHasPermissionsToAcceptOffer:v}}function Qe({chainId:t,tokenTo:a,amountTo:r,offerId:s}){const n=ee(),{address:o}=D(),i=te(),{writeContractAsync:c}=pe(),{writeContractAsync:d}=ge(),[l,f]=p.useState("idle"),[m,u]=p.useState(),[h,j]=p.useState(!1),w=p.useCallback(async()=>{f("approving");try{const x=h?ae:r,g=q[t];if(!g||!x||!a||!o)return;const y=await c({abi:C,functionName:"approve",address:a,args:[g,x]}),A=i==null?void 0:i.waitForTransactionReceipt({hash:y});if(!A)return N.error("Cannot request approve",{description:"Please, try again later"});N.promise(A,{loading:"Waiting for approval confirmation...",success:"Successfully approved",error:"Approval transaction failed"}),await A;const T=await(i==null?void 0:i.readContract({address:a,abi:C,functionName:"allowance",args:[o,g]}));T!==void 0&&r!==void 0&&T>=r?f("approved"):N.error("Insufficient balance for exchange")}catch(x){console.error(x),N.error("Something went wrong during token approve"),f("idle")}},[r,t,h,i,a,o,c]),v=p.useCallback(async()=>{if(f("accepting"),N.dismiss(),!i)return N.error("No public client!");try{const x=await d({args:[BigInt(s)]}),g=i.waitForTransactionReceipt({hash:x});N.promise(g,{loading:"Waiting for confirmation...",success:"Offer successfully accepted!",error:"Transaction failed"}),await g,await n.invalidateQueries({queryKey:["offerDetails",s]}),u(x),f("accepted")}catch(x){console.error(x),N.error("Something went wrong during offer acceptance"),f("approved")}},[s,i,n,d]);return{step:l,setStep:f,txHash:m,infiniteApprove:h,setInfiniteApprove:j,handleApprove:w,handleAcceptTrade:v}}const Ge=({tokenAddress:t,requiredAmount:a=0n,enabled:r})=>{const{address:s}=D(),n=k(),o=!t,i=n?q[n]:void 0,{data:c,isLoading:d}=ne({address:s,query:{enabled:r&&o&&!!s}}),{data:l,isLoading:f}=P({abi:C,address:t,functionName:"balanceOf",args:s?[s]:void 0,query:{enabled:r&&!o&&!!s&&!!t}}),m=d||f,h=((o?c==null?void 0:c.value:l)??0n)>=a,{data:j=0n,isLoading:w}=P({abi:C,functionName:"allowance",address:t,args:!o&&s&&i?[s,i]:void 0,query:{enabled:r&&!o&&h&&!!s&&!!i}}),v=o||j>=a;return{sufficientBalance:h,sufficientAllowance:v,needsApproval:!o&&h&&!v,canAcceptOffer:h&&v,isAllowanceChecking:m||w,isNative:o}},Ke=se("/trade-erc-20/$offer/");function Me(){const t=Ke.useParams(),a=k(),{tokenFrom:r,tokenTo:s,amountFrom:n,amountTo:o,completed:i,detailsLoading:c,isNativeTokenTo:d,isUserOfferOwner:l,optionalTaker:f,isUserHasPermissionsToAcceptOffer:m}=Ye(t.offer),{step:u,setStep:h,txHash:j,infiniteApprove:w,setInfiniteApprove:v,handleApprove:x,handleAcceptTrade:g}=Qe({chainId:a,tokenTo:s,amountTo:o,offerId:t.offer}),{sufficientBalance:y,isAllowanceChecking:A,canAcceptOffer:T}=Ge({tokenAddress:d?void 0:s,requiredAmount:o,enabled:!i&&!l});p.useEffect(()=>{!A&&u==="idle"&&(T||d)&&h("approved")},[u,T,d,h,A]);const Y=l||!m?"Offer exchange details:":"You will have to sign 2 transactions: Approval of token & Accept Trade";return c||A?e.jsx(re,{}):u==="accepted"||i?e.jsx(Je,{amountFrom:n,amountTo:o,chainId:a,tokenFrom:r,tokenTo:s,txHash:j}):e.jsx("section",{className:"container",children:e.jsxs(z,{className:"m-auto max-w-2xl",children:[e.jsxs(U,{children:[e.jsxs(H,{children:["Offer ID #",t.offer]}),e.jsx(E,{children:Y})]}),e.jsxs(W,{className:"space-y-6",children:[!y&&!l?e.jsxs(de,{className:"border-destructive text-destructive",children:[e.jsx(Se,{className:"h-4 w-4"}),e.jsx(ue,{children:"Insufficient balance!"})]}):null,e.jsxs("div",{className:"flex items-center gap-x-12",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"mb-1 font-medium text-muted-foreground text-sm",children:l?"You give":"You get"}),e.jsx(S,{address:r,amount:n})]}),e.jsx(I,{className:"mt-5"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"mb-1 font-medium text-muted-foreground text-sm",children:l?"You want":"You pay"}),e.jsx(S,{address:s,amount:o})]}),e.jsx(V,{address1:r,address2:s,amount1:n,amount2:o})]}),e.jsxs("div",{className:"my-6 flex items-center gap-x-4",children:[e.jsx("div",{className:"relative size-12",children:e.jsx(I,{className:"absolute inset-0 m-auto"})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{children:f}),e.jsx("div",{className:"text-muted-foreground text-sm",children:"Receiver"})]})]}),l||!m?null:e.jsxs(e.Fragment,{children:[e.jsx(R,{}),e.jsxs("div",{className:"my-6 flex items-center gap-2 text-muted-foreground",children:[e.jsx(ve,{id:"infinite-approve",disabled:u==="approved"||u==="approving"||u==="accepting"||!y,onCheckedChange:Q=>{v(!!Q)},checked:w}),e.jsx(fe,{htmlFor:"infinite-approve",children:"Infinite approve"})]}),e.jsxs(Re,{className:"flex-col px-0",children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx(L,{variant:"secondary",disabled:u!=="idle"||!y,onClick:x,children:u==="approving"?"Approving...":"Approve Token"}),e.jsx(L,{variant:"outline",disabled:u!=="approved",onClick:g,children:u==="accepting"?"Accepting...":"Accept Trade"})]}),e.jsxs("div",{className:"my-4 flex w-full items-center justify-center",children:[e.jsx(B,{active:u==="idle"||u==="approving",completed:u==="approved"||u==="accepting",step:1}),e.jsx(R,{className:"max-w-4"}),e.jsx(B,{active:u==="approved"||u==="accepting",completed:!1,step:2})]}),e.jsxs("div",{className:"flex w-full items-center justify-between text-muted-foreground text-sm",children:[e.jsx("div",{children:"Gas Price"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ke,{className:"size-4"})," ~ Gas will be calculated in your wallet"]})]})]})]})]})]})})}function B({step:t,active:a,completed:r}){return e.jsx("div",{className:b("flex size-5 shrink-0 flex-col items-center justify-center rounded-full border text-[10px] text-foreground",a?"border-transparent bg-primary text-primary-foreground":"bg-transparent"),children:r?e.jsx(ye,{className:"size-3"}):t})}function Je({tokenFrom:t,tokenTo:a,amountFrom:r,amountTo:s,txHash:n,chainId:o}){return e.jsx("section",{className:"container",children:e.jsxs(z,{className:"m-auto max-w-2xl",children:[e.jsxs(U,{children:[e.jsx(H,{children:"Trade Complete"}),e.jsx(E,{children:e.jsx(E,{children:n?"You have successfully exchanged tokens":"This offer has already been completed."})})]}),e.jsxs(W,{children:[e.jsxs("div",{className:"flex items-center gap-x-6",children:[e.jsx(S,{address:t,amount:r}),e.jsx(I,{}),e.jsx(S,{address:a,amount:s}),e.jsx(V,{address1:t,address2:a,amount1:r,amount2:s})]}),n?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"my-6"}),e.jsxs("div",{className:"flex items-center justify-between text-muted-foreground text-sm",children:[e.jsx("span",{children:"Transaction"}),e.jsxs("a",{href:oe(o,n),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 hover:underline",children:["View on Explorer",e.jsx(Ae,{className:"h-4 w-4"})]})]})]}):null]})]})})}const st=Me;export{st as component};
